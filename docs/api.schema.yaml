openapi: 3.0.0
info:
  title: AtCoder Search Backend API
  description: AtCoder Search backend API
  version: 0.1.0
paths:
  /api/search:
    get:
      summary: Search problems with query parameter
      description: Search problems
      parameters:
        - in: query
          name: keyword
          schema:
            type: string
            maxLength: 200
          description: The search keyword.
          required: false
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 20
          description: Maximum number of search results per page.
          required: false
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: The page index of search results.
          required: false
        - in: query
          name: filter.category[]
          schema:
            type: array
            items:
              type: string
          example: "ABC"
          description: Filter by contest type. Multiple values are accepted. Set the value in the f[category][] key for each value.
          explode: true
        - in: query
          name: filter.difficulty.from
          schema:
            type: integer
          example: 1000
          description: Filter by problem difficulty.
        - in: query
          name: filter.difficulty.to
          schema:
            type: integer
          example: 2000
          description: Filter by problem difficulty.
        - in: query
          name: sort
          schema:
            type: string
            enum:
              - "start_at"
              - "-start_at"
              - "difficulty"
              - "-difficulty"
              - "-score"
            default: -score
        - in: query
          name: facet
          schema:
            type: array
            items:
              type: string
              enum:
                - "category"
                - "difficulty"
      responses:
        200:
          description: "Search result"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
        400:
          description: "Bad request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
    post:
      summary: Search problems with json request
      description: Search problems with json request
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                keyword:
                  type: string
                  maxLength: 200
                limit:
                  type: integer
                  minimum: 1
                  maximum: 200
                  default: 20
                page:
                  type: integer
                  minimum: 1
                  default: 1
                sort:
                  type: string
                  enum:
                    - "start_at"
                    - "-start_at"
                    - "difficulty"
                    - "-difficulty"
                    - "-score"
                  default: -score
                filter:
                  type: object
                  properties:
                    category:
                      type: array
                      items:
                        type: string
                    difficulty:
                      type: object
                      properties:
                        from:
                          type: integer
                        to:
                          type: integer
                facet:
                  type: array
                  items:
                    type: string
                    enum:
                      - "category"
                      - "difficulty"
      responses:
        200:
          description: "Search result"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
        400:
          description: "Bad request"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
components:
  schemas:
    # ----------------------------
    # 検索結果のレスポンス
    # ----------------------------
    SearchResponse:
      type: object
      properties:
        stats:
          type: object
          $ref: "#/components/schemas/Stats"
        items:
          type: array
          items:
            type: object
            $ref: "#/components/schemas/Item"
        message:
          type: string
      required:
        - stats
        - items
    # ------------------
    # 検索結果の統計情報
    # ------------------
    Stats:
      type: object
      properties:
        # 検索処理時間
        time:
          type: integer
        # 総検索ヒット数
        total:
          type: integer
        # 表示ページ番号
        index:
          type: integer
        # 総ページ数
        pages:
          type: integer
        # 返却件数
        count:
          type: integer
        # ファセット情報
        params:
          type: object
          $ref: "#/components/schemas/SearchParams"

        facet:
          type: object
          $ref: "#/components/schemas/FacetResult"
      required:
        - time
        - total
        - index
        - pages
        - count
    # --------------------
    # リクエストパラメータ
    # --------------------
    SearchParams:
      type: object
    # ------------------
    # ファセット情報
    # ------------------
    FacetResult:
      type: object
      properties:
        category:
          type: object
          $ref: "#/components/schemas/FieldFacetResultPart"
        difficulty:
          type: object
          $ref: "#/components/schemas/RangeFacetResultPart"
    # ------------------------
    # フィールドファセット情報
    # ------------------------
    FieldFacetResultPart:
      type: object
      properties:
        counts:
          type: array
          items:
            type: object
            properties:
              key:
                type: string
              count:
                type: integer
    # ------------------
    # 範囲ファセット情報
    # ------------------
    RangeFacetResultPart:
      type: object
      properties:
        counts:
          type: array
          items:
            type: object
            properties:
              begin:
                type: string
              end:
                type: string
              count:
                type: integer
        start:
          type: string
        end:
          type: string
        gap:
          type: string
        before:
          type: string
        after:
          type: string
        between:
          type: string
    # -----------------------
    # ドキュメント
    # -----------------------
    Item:
      type: object
      properties:
        problem_id:
          type: string
        problem_title:
          type: string
        problem_url:
          type: string
          format: uri
        contest_id:
          type: string
        contest_title:
          type: string
        contest_url:
          type: string
          format: uri
        difficulty:
          type: integer
        start_at:
          type: string
          format: date-time
        duration:
          type: integer
        rate_change:
          type: string
        category:
          type: string
